<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daps â€¢ Account</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --container:1160px;
      --radius-lg:14px;
      --line:#EDEEF1;
      --ink:#0A0A0B;
      --muted:#6B7280;
      --beta:#FF6000;
      --cta-a:#DAFA22;
      --cta-b:#64FA00;
      --shadow-1:0 2px 2px rgba(16,24,40,.04), 0 10px 20px rgba(16,24,40,.07);
      --shadow-2:0 8px 24px rgba(16,24,40,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:Poppins,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink); background:#FAFBFC;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* Header */
    .site-header{position:sticky;top:0;z-index:30;background:#fff;border-bottom:1px solid var(--line)}
    .bar{max-width:var(--container);margin:auto;display:flex;align-items:center;gap:12px;padding:14px 20px}
    .brand{display:flex;align-items:center;gap:10px;cursor:pointer}
    .brand .logo{height:30px;width:auto}
    .beta{font-size:12px;font-weight:700;color:#fff;background:var(--beta);padding:2px 8px;border-radius:6px}

    /* Main Content */
    .main{max-width:var(--container);margin:auto;padding:40px 20px 80px}
    h1{font-weight:900;font-size:40px;letter-spacing:-.02em;margin:0 0 12px;text-align:center}
    .subtitle{color:var(--muted);font-size:16px;margin:0 0 32px;text-align:center;line-height:1.4}

    /* Auth wrapper card */
    .auth-shell{
      max-width:460px;
      margin:0 auto;
      background:#fff;
      border:1px solid var(--line);
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-1);
    }

    /* Tabs header */
    .auth-tabs{
      display:flex;
      align-items:flex-end;
      justify-content:space-around;
      font-size:16px;
      font-weight:600;
      line-height:1.2;
      border-bottom:1px solid var(--line);
      padding:20px 20px 0;
    }
    .auth-tab-btn{
      flex:1;
      text-align:center;
      padding:0 8px 14px;
      cursor:pointer;
      color:#4B5563;
      position:relative;
      border:0;
      background:none;
      font-family:inherit;
      font-size:16px;
      font-weight:600;
    }
    .auth-tab-btn.active{
      color:var(--ink);
      font-weight:700;
    }
    .auth-tab-btn.active::after{
      content:"";
      position:absolute;
      left:0;right:0;bottom:0;
      height:3px;
      background:#000;
      border-radius:2px;
    }

    /* Panel body */
    .auth-body{
      padding:24px 20px 28px;
    }

    .panel-title{
      font-size:24px;
      font-weight:900;
      margin:0 0 8px;
      letter-spacing:-.01em;
    }
    .panel-subtitle{
      color:var(--muted);
      font-size:14px;
      margin:0 0 24px;
      line-height:1.4;
    }

    /* Form layout */
    form{margin:0}
    .form-field{margin-bottom:16px}
    .form-label{
      display:block;
      font-weight:700;
      font-size:14px;
      margin-bottom:8px;
    }
    .input-wrap{
      position:relative;
      display:flex;
      align-items:stretch;
    }
    input{
      width:100%;
      height:44px;
      border:1px solid #D9DDE4;
      border-radius:10px;
      padding:0 14px;
      font-family:inherit;
      font-size:14px;
      outline:0;
      transition:border-color .15s, box-shadow .15s, background-color .15s;
      background:#fff;
    }
    input:focus{
      border-color:#9CA3AF;
      background:#fff;
      box-shadow:0 0 0 2px rgba(156,163,175,.2);
    }

    /* helper text under password etc */
    .helper{
      color:var(--ink);
      font-size:13px;
      line-height:1.4;
      margin-top:-4px;
      margin-bottom:16px;
    }
    .helper.muted{
      color:var(--muted);
      margin-top:8px;
      margin-bottom:20px;
    }

    /* agreement row */
    .agree-row{
      display:flex;
      align-items:flex-start;
      gap:10px;
      font-size:14px;
      line-height:1.4;
      margin-bottom:20px;
    }
    .agree-row input[type="checkbox"]{
      width:20px;
      height:20px;
      border-radius:4px;
      border:1px solid #D9DDE4;
      flex-shrink:0;
      margin-top:2px;
    }
    .agree-row a{
      color:#0A0A0B;
      text-decoration:underline;
      font-weight:500;
    }

    /* forgot password row / tos row */
    .row-between{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      font-size:13px;
      margin-top:8px;          /* increased spacing below password field */
      margin-bottom:24px;      /* more breathing room before button */
      flex-wrap:wrap;
      gap:8px;
    }
    .row-between a{
      color:#0A0A0B;
      text-decoration:underline;
      font-weight:500;
      font-size:13px;
    }

    .tos-copy{
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
      margin-top:20px;
      margin-bottom:0;
    }
    .tos-copy a{
      color:#0A0A0B;
      font-weight:500;
      text-decoration:underline;
    }

    /* Buttons */
    button{
      width:100%;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      font-size:15px;
      font-family:inherit;
      transition:transform .12s,box-shadow .12s,background .12s,color .12s,border-color .12s;
    }

    button[type="submit"]{
      background:linear-gradient(90deg,var(--cta-a),var(--cta-b));
      color:#073b0f;
      padding:12px 16px;
      box-shadow:0 4px 16px rgba(100,250,0,.2);
      margin-bottom:16px;
    }
    button[type="submit"]:hover{
      transform:translateY(-1px);
      box-shadow:0 6px 20px rgba(100,250,0,.3);
    }
    button[type="submit"]:active{
      transform:translateY(0);
    }

    /* Toast */
    #toast{
      position:fixed;right:24px;bottom:24px;background:#111;color:#fff;
      padding:14px 18px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.2);
      display:none;font-weight:600;z-index:1000;
      max-width:260px;
      font-size:14px;
      line-height:1.4;
    }

    /* Footer */
    footer{border-top:1px solid var(--line);background:#FAFBFC;margin-top:60px}
    .foot{
      max-width:var(--container);margin:auto;padding:26px 20px;
      display:flex;align-items:center;gap:18px;
      color:#6B7280;font-size:14px;line-height:1.4;flex-wrap:wrap;
    }
    .foot a{color:inherit;text-decoration:none;font-weight:500}
    .foot a:hover{text-decoration:underline}
    .foot-spacer{margin-left:auto}

    /* Responsive tweaks */
    @media (max-width:480px){
      h1{font-size:32px}
      .auth-shell{border-radius:12px}
      .auth-tabs{padding-left:16px;padding-right:16px}
      .auth-body{padding:20px 16px 24px}
      .row-between{flex-direction:column;align-items:flex-start}
      .foot-spacer{margin-left:0}
    }
  </style>
</head>
<body>

<header class="site-header">
  <div class="bar">
    <div class="brand" onclick="window.location.href='/index.html'">
      <img class="logo" src="./images/Daps-2 Copy.png" alt="Daps Bounty logo">
      <span class="beta">BETA</span>
    </div>
  </div>
</header>

<main class="main">
  <h1>My Account</h1>
  <p class="subtitle">Create an account or sign in to submit offers</p>

  <section class="auth-shell">
    <!-- tab header -->
    <div class="auth-tabs">
      <button class="auth-tab-btn active" data-tab="create">Create Account</button>
      <button class="auth-tab-btn" data-tab="signin">Sign In</button>
    </div>

    <!-- CREATE ACCOUNT PANEL -->
    <div class="auth-body" id="panel-create">
      <h2 class="panel-title">Sign Up</h2>
      <p class="panel-subtitle">New to Daps? Get started here</p>

      <form id="registerForm" autocomplete="on">
        <div class="form-field">
          <label class="form-label" for="firstName">First Name<span style="color:#EF4444">*</span></label>
          <div class="input-wrap">
            <input name="firstName" id="firstName" autocomplete="given-name" required>
          </div>
        </div>

        <div class="form-field">
          <label class="form-label" for="lastName">Last Name<span style="color:#EF4444">*</span></label>
          <div class="input-wrap">
            <input name="lastName" id="lastName" autocomplete="family-name" required>
          </div>
        </div>

        <div class="form-field">
          <label class="form-label" for="regEmail">Email Address<span style="color:#EF4444">*</span></label>
          <div class="input-wrap">
            <input name="email" id="regEmail" type="email" autocomplete="email" required>
          </div>
        </div>

        <div class="form-field">
          <label class="form-label" for="regPass">Password<span style="color:#EF4444">*</span></label>
          <div class="input-wrap">
            <input name="password" id="regPass" type="password" autocomplete="new-password" required>
          </div>
        </div>

        <div class="helper">At least 8 characters, 1 uppercase letter, 1 number &amp; 1 symbol</div>

        <div class="form-field">
          <label class="form-label" for="regPass2">Confirm Password<span style="color:#EF4444">*</span></label>
          <div class="input-wrap">
            <input name="passwordConfirm" id="regPass2" type="password" autocomplete="new-password" required>
          </div>
        </div>

        <div class="agree-row">
          <input type="checkbox" id="agreeTerms">
          <label for="agreeTerms" style="font-weight:400;cursor:pointer;">
            I have read and agree to the
            <a href="#">Terms and Conditions</a> and
            <a href="#">Privacy Policy</a>.
          </label>
        </div>

        <button type="submit">Sign Up</button>

        <!-- Social / OR removed intentionally -->

      </form>

    </div><!-- /panel-create -->


    <!-- SIGN IN PANEL -->
    <div class="auth-body" id="panel-signin" style="display:none;">
      <h2 class="panel-title">Log In</h2>
      <p class="panel-subtitle">Already have an account?</p>

      <form id="loginForm" autocomplete="on">
        <div class="form-field">
          <label class="form-label" for="loginEmail">Email Address<span style="color:#EF4444">*</span></label>
          <div class="input-wrap">
            <input name="email" id="loginEmail" type="email" autocomplete="email" required>
          </div>
        </div>

        <div class="form-field" style="margin-bottom:0;">
          <label class="form-label" for="loginPass">Password<span style="color:#EF4444">*</span></label>
          <div class="input-wrap">
            <input name="password" id="loginPass" type="password" autocomplete="current-password" required>
          </div>
        </div>

        <div class="row-between">
          <span></span>
          <a href="#" id="forgotLink">Forgot Password?</a>
        </div>

        <button type="submit">Log In</button>

        <div class="tos-copy">
          By logging in, you agree to the
          <a href="#">Terms of Service</a> and
          <a href="#">Privacy Policy</a>.
        </div>

        <!-- Social / OR removed intentionally -->

        <div style="display:none;">
          <!-- keep these buttons in DOM but hidden so IDs/functions elsewhere don't explode -->
          <button type="button" id="btnResend" class="btn-secondary" style="display:none;">Resend Verification</button>
          <button type="button" id="btnForgot" class="btn-secondary" style="display:none;">Reset Password</button>
        </div>

      </form>
    </div><!-- /panel-signin -->

  </section>
</main>

<footer>
  <div class="foot">
    <span>Copyright Â© 2025 Daps</span>
    <span class="foot-spacer"></span>
    <a href="#">Privacy policy</a>
    <span aria-hidden="true"> Â· </span>
    <a href="#">Terms of use</a>
  </div>
</footer>

<div id="toast"></div>

<script>
(function(){
  var API = 'http://localhost:5175/api/users';

  function toast(msg){
    var t = document.getElementById('toast');
    t.textContent = msg;
    t.style.display = 'block';
    setTimeout(function(){ t.style.display='none'; }, 3000);
  }

  var token = localStorage.getItem('jwt') || '';
  function setToken(t){ 
    token = t || ''; 
    if(token) localStorage.setItem('jwt', token); 
    else localStorage.removeItem('jwt'); 
  }

  // Check if already logged in - WITH ERROR HANDLING
  if(token){
    fetch(API + '/me', { 
      headers:{ Authorization: 'Bearer ' + token }
    }).then(function(res){
      if(res.ok){
        // Already logged in, redirect
        window.location.href = '/index.html';
      } else {
        // Invalid token, clear it
        console.log('[user] Invalid token, clearing...');
        localStorage.removeItem('jwt');
      }
    }).catch(function(err){
      // Network error or server down, just clear token
      console.error('[user] Auth check failed:', err);
      localStorage.removeItem('jwt');
    });
  }

  // REGISTER
  var regForm = document.getElementById('registerForm');
  if (regForm) regForm.addEventListener('submit', function(e){
    e.preventDefault();
    var fd = new FormData(regForm);
    var firstName = (fd.get('firstName') || '').toString().trim();
    var lastName = (fd.get('lastName') || '').toString().trim();
    var email = (fd.get('email') || '').toString().trim();
    var password = (fd.get('password') || '').toString();
    var passwordConfirm = (fd.get('passwordConfirm') || '').toString();

    if (!email || !password || !passwordConfirm) return toast('Please fill all required fields.');
    if (password !== passwordConfirm) return toast('Passwords do not match.');

    fetch(API + '/register', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ 
        firstName: firstName, 
        lastName: lastName, 
        email: email, 
        password: password, 
        passwordConfirm: passwordConfirm 
      })
    }).then(function(res){
      return res.json().then(function(data){
        return { ok: res.ok, data: data };
      }).catch(function(){ 
        return { ok: res.ok, data: {} }; 
      });
    }).then(function(result){
      if (result.ok){
        toast('Check your email for a verification link!');
        regForm.reset();
      } else {
        toast(result.data.error || 'Could not create account.');
      }
    }).catch(function(err){
      console.error('register error', err);
      toast('Network error while registering.');
    });
  });

  // LOGIN
  var loginForm = document.getElementById('loginForm');
  if (loginForm) loginForm.addEventListener('submit', function(e){
    e.preventDefault();
    var fd = new FormData(loginForm);
    var email = (fd.get('email') || '').toString().trim();
    var password = (fd.get('password') || '').toString();
    if (!email || !password) return toast('Email and password required.');

    fetch(API + '/login', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ email: email, password: password })
    }).then(function(res){
      return res.json().then(function(data){
        return { ok: res.ok, data: data };
      }).catch(function(){ 
        return { ok: res.ok, data: {} }; 
      });
    }).then(function(result){
      if (result.ok){
        setToken(result.data.token);
        toast('Signed in! Redirecting...');
        setTimeout(function(){
          window.location.href = '/index.html';
        }, 1000);
      } else {
        toast(result.data.error || 'Could not sign in.');
      }
    }).catch(function(err){
      console.error('login error', err);
      toast('Network error while signing in.');
    });
  });

  // RESEND VERIFY (buttons hidden visually but still wired)
  var btnResend = document.getElementById('btnResend');
  if (btnResend) btnResend.addEventListener('click', function(){
    var email = document.getElementById('loginEmail').value.trim();
    if (!email) return toast('Enter your email in the Sign in form first.');
    fetch(API + '/resend-verification', {
      method:'POST', 
      headers:{'Content-Type':'application/json'}, 
      body: JSON.stringify({ email: email })
    }).then(function(res){
      toast(res.ok ? 'Verification email sent (if account exists).' : 'Could not resend verification email.');
    });
  });

  // FORGOT PASSWORD (same as before)
  var btnForgot = document.getElementById('btnForgot');
  if (btnForgot) btnForgot.addEventListener('click', function(){
    var email = document.getElementById('loginEmail').value.trim();
    if (!email) return toast('Enter your email in the Sign in form first.');
    fetch(API + '/request-password-reset', {
      method:'POST', 
      headers:{'Content-Type':'application/json'}, 
      body: JSON.stringify({ email: email })
    }).then(function(res){
      toast(res.ok ? 'Password reset email sent (if account exists).' : 'Could not send password reset email.');
    });
  });

  // TAB SWITCH LOGIC (non-destructive)
  var tabBtns = document.querySelectorAll('.auth-tab-btn');
  var panelCreate = document.getElementById('panel-create');
  var panelSignin = document.getElementById('panel-signin');

  function activateTab(which){
    tabBtns.forEach(function(btn){
      if(btn.getAttribute('data-tab')===which){
        btn.classList.add('active');
      }else{
        btn.classList.remove('active');
      }
    });

    if(which==='create'){
      panelCreate.style.display='block';
      panelSignin.style.display='none';
    }else{
      panelCreate.style.display='none';
      panelSignin.style.display='block';
    }
  }

  tabBtns.forEach(function(btn){
    btn.addEventListener('click', function(){
      activateTab(btn.getAttribute('data-tab'));
    });
  });

  // inline "Forgot Password?" link
  var forgotLink = document.getElementById('forgotLink');
  if(forgotLink){
    forgotLink.addEventListener('click', function(ev){
      ev.preventDefault();
      var email = document.getElementById('loginEmail').value.trim();
      if (!email) {
        toast('Enter your email first.');
        return;
      }
      fetch(API + '/request-password-reset', {
        method:'POST', 
        headers:{'Content-Type':'application/json'}, 
        body: JSON.stringify({ email: email })
      }).then(function(res){
        toast(res.ok ? 'Password reset email sent (if account exists).' : 'Could not send password reset email.');
      });
    });
  }

})();
</script>
</body>
</html>
